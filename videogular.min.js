"use strict";angular.module("com.2fdevs.videogular",["ngSanitize"]).constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).constant("VG_EVENTS",{ON_PLAY:"onVgPlay",ON_PAUSE:"onVgPause",ON_PLAY_PAUSE:"onVgPlayPause",ON_START_PLAYING:"onVgStartPlaying",ON_COMPLETE:"onVgComplete",ON_SET_STATE:"onVgSetState",ON_SET_VOLUME:"onVgSetVolume",ON_TOGGLE_FULLSCREEN:"onVgToggleFullscreen",ON_ENTER_FULLSCREEN:"onVgEnterFullscreen",ON_EXIT_FULLSCREEN:"onVgExitFullscreen",ON_BUFFERING:"onVgBuffering",ON_UPDATE_TIME:"onVgUpdateTime",ON_SEEK_TIME:"onVgSeekTime",ON_UPDATE_SIZE:"onVgUpdateSize",ON_UPDATE_THEME:"onVgUpdateTheme",ON_PLAYER_READY:"onVgPlayerReady",ON_LOAD_POSTER:"onVgLoadPoster",ON_ERROR:"onVgError"}).service("VG_UTILS",function(){this.fixEventOffset=function(a){if(navigator.userAgent.match(/Firefox/i)){var b=a.currentTarget.currentStyle||window.getComputedStyle(a.target,null),c=parseInt(b.borderLeftWidth,10),d=parseInt(b.borderTopWidth,10),e=a.currentTarget.getBoundingClientRect(),f=a.clientX-c-e.left,g=a.clientY-d-e.top;a.offsetX=f,a.offsetY=g}return a},this.getZIndex=function(){var a=1;return angular.element("*").filter(function(){return"auto"!==angular.element(this).css("zIndex")}).each(function(){var b=parseInt(angular.element(this).css("zIndex"));b>a&&(a=b+1)}),a},this.isMobileDevice=function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},this.isiOSDevice=function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)}}).run(["$window","VG_UTILS",function(a,b){var c,d={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:void 0,onexit:"webkitendfullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",onchange:"msfullscreenchange",onerror:"msfullscreenerror"}};for(var e in d)if(d[e].enabled in document){c=d[e],c.isFullScreen=function(){return null!=document[this.element]};break}b.isiOSDevice()&&(c=d.ios,c.isFullScreen=function(){return null!=document[this.element]}),angular.element(a)[0].fullScreenAPI=c}]).directive("videogular",["$window","VG_STATES","VG_EVENTS","VG_UTILS",function(a,b,c,d){return{restrict:"E",scope:{playerWidth:"=vgWidth",playerHeight:"=vgHeight",theme:"=vgTheme",autoPlay:"=vgAutoplay",responsive:"=vgResponsive",stretch:"=vgStretch",vgComplete:"&",vgUpdateVolume:"&",vgUpdateTime:"&",vgUpdateSize:"&",vgUpdateState:"&",vgPlayerReady:"&",vgChangeSource:"&"},controller:["$scope",function(e){var f=null,g=null,h=null,i=e.stretch,j=0,k=0,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=!1,s=this,t=e.vgComplete(),u=e.vgUpdateVolume(),v=e.vgUpdateTime(),w=e.vgUpdateSize(),x=e.vgUpdateState(),y=e.vgPlayerReady(),z=e.vgChangeSource();e.currentState=b.STOP,this.$on=function(){e.$on.apply(e,arguments)},this.isPlayerReady=function(){return q},this.seekTime=function(a,b){var d;b?(d=a*this.videoElement[0].duration/100,this.videoElement[0].currentTime=d):(d=a,this.videoElement[0].currentTime=d),e.$emit(c.ON_SEEK_TIME,[d])},this.playPause=function(){this.videoElement[0].paused?this.play():this.pause()},this.setState=function(a){return a&&a!=e.currentState&&(e.vgUpdateState()&&(x=e.vgUpdateState())(a),e.currentState=a,e.$emit(c.ON_SET_STATE,[e.currentState])),e.currentState},this.play=function(){this.videoElement[0].play(),this.setState(b.PLAY),e.$emit(c.ON_PLAY)},this.pause=function(){this.videoElement[0].pause(),this.setState(b.PAUSE),e.$emit(c.ON_PAUSE)},this.stop=function(){this.videoElement[0].pause(),this.videoElement[0].currentTime=0,this.setState(b.STOP),e.$emit(c.ON_COMPLETE)},this.toggleFullScreen=function(){angular.element(a)[0].fullScreenAPI?angular.element(a)[0].fullScreenAPI.isFullScreen()?d.isMobileDevice()||document[angular.element(a)[0].fullScreenAPI.exit]():d.isMobileDevice()?d.isiOSDevice()?n?this.enterElementInFullScreen(this.videoElement[0]):(l=!0,this.play()):this.enterElementInFullScreen(this.videoElement[0]):this.enterElementInFullScreen(this.elementScope[0]):(m?(this.videogularElement.removeClass("fullscreen"),this.videogularElement.css("z-index",0)):(this.videogularElement.addClass("fullscreen"),this.videogularElement.css("z-index",d.getZIndex())),m=!m,e.updateSize())},this.enterElementInFullScreen=function(b){b[angular.element(a)[0].fullScreenAPI.request]()},this.changeSource=function(a){e.vgChangeSource()&&(z=e.vgChangeSource())(a)},this.setVolume=function(a){e.vgUpdateVolume()&&(u=e.vgUpdateVolume())(a),this.videoElement[0].volume=a,e.$emit(c.ON_SET_VOLUME,[a])},this.updateTheme=function(a){if(f)for(var b=document.getElementsByTagName("link"),c=0,d=b.length;d>c;c++)b[c].outerHTML.indexOf(f)>=0&&b[c].parentNode.removeChild(b[c]);if(a){var e=angular.element(document).find("head");e.append("<link rel='stylesheet' href='"+a+"'>"),f=a}},this.updateStretch=function(a){i=a,e.updateSize()},this.setSize=function(a,b){g=a,h=b,e.updateSize()},this.getSize=function(){return{width:g,height:h}},e.API=this,e.init=function(){s.updateTheme(e.theme),e.addBindings(),void 0==e.playerWidth||void 0==e.playerHeight||1==e.responsive?(r=!0,angular.element(a).bind("resize",e.onResizeBrowser)):(j=e.playerWidth,k=e.playerHeight,s.setSize(j,k)),angular.element(a)[0].fullScreenAPI&&document.addEventListener(angular.element(a)[0].fullScreenAPI.onchange,e.onFullScreenChange)},e.addBindings=function(){e.$watch("playerWidth",function(a,b){a!=b&&s.setSize(a,h)}),e.$watch("playerHeight",function(a,b){a!=b&&s.setSize(g,a)}),e.$watch("theme",function(a,b){a!=b&&s.updateTheme(a)}),e.$watch("stretch",function(a,b){a!=b&&s.updateStretch(a)}),e.$watch("autoPlay",function(a,b){a!=b&&s.play()}),e.$watch("responsive",function(b,c){b!=c&&(r=b,r?(angular.element(a).bind("resize",e.onResizeBrowser),e.onResizeBrowser()):(angular.element(a).unbind("resize",e.onResizeBrowser),g=e.playerWidth,h=e.playerHeight,e.updateSize()))})},e.onElementReady=function(){o=!0,p&&e.onPlayerReady()},e.onVideoReady=function(){p=!0,o&&e.onPlayerReady()},e.onPlayerReady=function(){s.videoElement[0].addEventListener("loadedmetadata",e.onLoadedMetaData),e.doPlayerReady()},e.onLoadedMetaData=function(){n=!0,e.doPlayerReady()},e.doPlayerReady=function(){if(r){var a=100*s.elementScope[0].parentNode.clientWidth/s.videoElement[0].videoWidth,f=s.videoElement[0].videoHeight*a/100;g=s.elementScope[0].parentNode.clientWidth,h=f}q=!0,e.updateSize(),e.vgPlayerReady()&&(y=e.vgPlayerReady())(s),e.$emit(c.ON_PLAYER_READY),(e.autoPlay&&!d.isMobileDevice()||e.currentState===b.PLAY)&&s.play()},e.updateSize=function(){if(q){var b,d,f;angular.element(a)[0].fullScreenAPI&&angular.element(a)[0].fullScreenAPI.isFullScreen()||m?(s.elementScope.css("width",parseInt(window.screen.width,10)+"px"),s.elementScope.css("height",parseInt(window.screen.height,10)+"px"),b=e.getVideoSize(window.screen.width,window.screen.height),m?(j=a.innerWidth,k=a.innerHeight):(j=a.screen.width,k=a.screen.height)):(s.elementScope.css("width",parseInt(g,10)+"px"),s.elementScope.css("height",parseInt(h,10)+"px"),b=e.getVideoSize(g,h),j=g,k=h),(0==h||isNaN(h))&&(j=b.width,k=b.height),(0==b.width||isNaN(b.width))&&(b.width=g),(0==b.height||isNaN(b.height))&&(b.height=h),f=(j-b.width)/2,d=(k-b.height)/2,s.videoElement.attr("width",parseInt(b.width,10)),s.videoElement.attr("height",parseInt(b.height,10)),s.videoElement.css("width",parseInt(b.width,10)+"px"),s.videoElement.css("height",parseInt(b.height,10)+"px"),s.videoElement.css("top",d+"px"),s.videoElement.css("left",f+"px"),s.elementScope.css("width",parseInt(j,10)+"px"),s.elementScope.css("height",parseInt(k,10)+"px"),e.vgUpdateSize()&&(w=e.vgUpdateSize())(j,k),e.$emit(c.ON_UPDATE_SIZE,[j,k])}},e.onResizeBrowser=function(){var a=100*s.elementScope[0].parentNode.clientWidth/s.videoElement[0].videoWidth,b=s.videoElement[0].videoHeight*a/100;g=s.elementScope[0].parentNode.clientWidth,h=b,e.updateSize()},e.onFullScreenChange=function(){e.$emit(angular.element(a)[0].fullScreenAPI.isFullScreen()?c.ON_ENTER_FULLSCREEN:c.ON_EXIT_FULLSCREEN),e.updateSize()},e.onComplete=function(){e.vgComplete()&&(t=e.vgComplete())(),s.setState(b.STOP),e.$emit(c.ON_COMPLETE)},e.onStartBuffering=function(){e.$emit(c.ON_BUFFERING)},e.onStartPlaying=function(a){a.target.width++,a.target.width--,e.$emit(c.ON_START_PLAYING,[a.target.duration])},e.onUpdateTime=function(a){e.vgUpdateTime()&&(v=e.vgUpdateTime())(a.target.currentTime,a.target.duration),e.$emit(c.ON_UPDATE_TIME,[a.target.currentTime,a.target.duration])},e.getVideoSize=function(a,b){var c,d,e={},f=s.videoElement[0].videoWidth/s.videoElement[0].videoHeight>a/b;return e.width=a,e.height=b,"fit"==i&&f||"fill"==i&&!f?(c=100*a/s.videoElement[0].videoWidth,e.height=s.videoElement[0].videoHeight*c/100):"fill"==i&&f||"fit"==i&&!f?(d=100*b/s.videoElement[0].videoHeight,e.width=s.videoElement[0].videoWidth*d/100):(e.width=s.videoElement[0].videoWidth,e.height=s.videoElement[0].videoHeight),(0==e.height||isNaN(e.height))&&(e.width=s.elementScope[0].parentElement.clientWidth,e.height=9*e.width/16),e},e.init()}],link:{pre:function(a,b,c,d){d.videogularElement=b,d.elementScope=angular.element(b),d.videoElement=d.elementScope.find("video"),d.videoElement[0].addEventListener("waiting",a.onStartBuffering,!1),d.videoElement[0].addEventListener("ended",a.onComplete,!1),d.videoElement[0].addEventListener("playing",a.onStartPlaying,!1),d.videoElement[0].addEventListener("timeupdate",a.onUpdateTime,!1),d.elementScope.ready(a.onElementReady),d.videoElement.ready(a.onVideoReady)}}}}]).directive("vgSrc",["VG_EVENTS","VG_UTILS",function(a){return{restrict:"A",link:{pre:function(b,c,d){function e(){if(g="",h[0].canPlayType){for(var c=0,d=f.length;d>c;c++)if(g=h[0].canPlayType(f[c].type),"maybe"==g||"probably"==g){h.attr("src",f[c].src),h.attr("type",f[c].type);break}}else h.attr("src",f[0].src),h.attr("type",f[0].type);""==g&&b.$broadcast(a.ON_ERROR,{type:"Can't play file"})}var f,g,h=c;b.$watch(d.vgSrc,function(a,b){f&&a==b||(f=a,e())})}}}}]);